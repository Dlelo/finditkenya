extends ../layout-new

block content
  #home.parallax-content-list.baner-content-listing-biz
    .container.container-margin-top
      .row.flowerwhite
        .col-md-12
          .row    
            .col-md-4      
              if(biz.photo)
                img.img-responsive(src="/uploads/thumbs/cover"+ biz.photo,width="80%") 
            .col-md-8
              h3.text-left 
                =biz.name
              
              p.text-left
                if (biz.openstatus.isOpen)
                  if (biz.openstatus.isOpen == true)
                    span.badge.badge-success
                      span.fas.fa-check-circle  
                      |  Now Open
                  else
                    span.badge.badge-danger
                      span.fas.fa-times-circle  
                      |  Now Closed
                - var list = [1,2,3,4,5]
                - list.sort((a,b)=>{return Math.random()-0.5})
              p.text-left
                each feature in biz.features
                  a(href="/subcategory/subcat/"+feature)
                    strong
                      
                      | #{feature} | 
          .row.flowerwhite   
            if(branches)
              .row
                .col-md-12
                  #map(style="position:unset !important; overflow: visible!important;")
                  //.row#map(height='95%',width="100%", style="visibility:visible;")
                  //iframe(width='100%', height='300', frameborder='0', style='border:0', src='https://www.google.com/maps/embed/v1/view?zoom='+biz.map.zoom+'&center='+biz.map.lati+','+biz.map.long+'&key=AIzaSyA0P3blnbZTWe7vHDrbX3Bsd7RA2Y5ViTk', allowfullscreen='',)
              
              .row                        
                .col-md-3.padding-map.mapbox.nomargin
                  if(branches)
                    div
                  else
                    iframe(width='100%', height='150', frameborder='0', style='border:0', src='https://www.google.com/maps/embed/v1/view?zoom='+biz.map.zoom+'&center='+biz.map.lati+','+biz.map.long+'&key=AIzaSyA0P3blnbZTWe7vHDrbX3Bsd7RA2Y5ViTk', allowfullscreen='',)
                  .row.is-island
                    .col-md-12
                      if(branches)
                        div
                      else
                        if biz.building
                          p.text-left.findit-blue
                            strong
                              span.fas.fa-building
                              |  #{biz.building}
                        if biz.street
                          p.text-left.findit-blue
                            strong
                              span.fas.fa-road
                              |  #{biz.street}
                    .col-md-12
                      p.text-left.findit-blue
                        strong
                          span.fas.fa-th-list
                          |  #{biz.subcategory}
                      hr.nomargin
                    if(biz.website)
                      .col-md-12
                        p.text-left.findit-blue
                          strong.findit-blue
                            span.fas.fa-globe
                            a.findit(href="http://"+biz.website,target="_blank")
                              |  Website
                      hr.nomargin
                    .col-md-12
                      p.text-left.findit-red
                        each phone in phones
                          span#biz-id(style="display:none")
                            =biz.id
                          span.fas.fa-phone
                          //remove style="display:none" on phoneno
                          a.findit.phoneno(href="tel:"+phone)
                            |  #{phone}
                          //a.findit.phonenofake(href="#")
                            |  Get Contacts
                          br
                      hr.nomargin
                    .col-md-12.text-left
                      p.text-left.findit-blue
                        each email in emails
                          strong.findit-blue
                            span.fas.fa-envelope
                            a.findit(href="mailto:"+email)
                              |  Mail
                          br
                      hr.nomargin
                    if(biz.facebook)
                      .col-md-12.text-left
                        p.findit-blue
                          strong
                            span.fab.fa-facebook-f
                            a.findit(href="http://"+biz.facebook,target="_blank") 
                              | Facebook
                    if(biz.twitter)
                      .col-md-12.text-left
                        p.findit-blue 
                          strong
                            span.fab.fa-twitter
                            a.findit(href="http://"+biz.twitter,target="_blank")
                              |  Twitter
                    if(biz.instagram)
                      .col-md-12.text-left
                        p.findit-blue 
                          strong
                            span.fab.fa-instagram
                            a.findit(href="http://"+biz.instagram,target="_blank")
                              |  Instagram
                    if(biz.linkedin)
                      .col-md-12.text-left
                        p.findit-blue 
                          strong
                            span.fab.fa-linkedin 
                            a.findit(href="http://"+biz.linkedin,target="_blank")
                              |  LinkedIn
                    if(biz.youtube)
                      .col-md-12.text-left
                        p.findit-red
                          strong
                            span.fab.fa-youtube
                            a.findit(href="http://"+biz.youtube,target="_blank")
                              |  Youtube
                    

                    if (biz.catalog.length)
                      .col-md-12.text-left
                        each catalogue, i in biz.catalog
                          if (catalogue)
                            strong
                              span.fas.fa-bars
                              
                              a.findit(href="/business/catalog/"+catalogue.filename, target="_blank")
                                |  View Menu #{i+1}
                          else
                              | 
                          hr   
                    .col-md-12.text-center.findit-red
                      if biz.paid
                        span.badge.badge-success
                          span.fa.fa-check-circle.strong(style="color:#2862ec;")
                          strong
                            |  Claimed
                      else
                        h4 Claim This Business
                        form(method='get', action='/claim-form/'+biz.id)
                          .form-group
                            input.form-control(name='phone', type='text', value='', placeholder='phone')
                          .form-group
                            input.form-control(name='email', type='text', value='', placeholder='email')
                          .form-group
                            button.btn.btn-danger.form-control(type='submit')                 
                              | Claim Business
                  if(branches)
                    div
                  else
                    if (biz.openstatus)
                      .row
                        .col-md-12.findit-red.padding20
                          strong
                            |  Opening & Closing Hours
                        .col-md-12
                          each hour in biz.hours.monday
                            if(hour.opens === hour.closes)
                              |  Closed
                            else
                              p Monday: #{hour.opens} - #{hour.closes}
                          each hour in biz.hours.tuesday
                            if(hour.opens === hour.closes)
                              |  Closed
                            else
                              p Tuesday: #{hour.opens} - #{hour.closes}
                          each hour in biz.hours.wednesday
                            if(hour.opens === hour.closes)
                              |  Closed
                            else
                              p Wednesday: #{hour.opens} - #{hour.closes}
                          each hour in biz.hours.thursday
                            if(hour.opens === hour.closes)
                              |  Closed
                            else
                              p Thursday: #{hour.opens} - #{hour.closes}
                          each hour in biz.hours.friday
                            if(hour.opens === hour.closes)
                              |  Closed
                            else
                              p Friday: #{hour.opens} - #{hour.closes}
                          each hour in biz.hours.saturday
                            if(hour.opens === hour.closes)
                              |  Closed
                            else
                              p Saturday: #{hour.opens} - #{hour.closes}
                          each hour in biz.hours.sunday
                            if(hour.opens === hour.closes)
                              |  Closed
                            else
                              p Sunday: #{hour.opens} - #{hour.closes}
              .col-md-6.col-xs-12
                .row(width="100%")
                  .col-md-12
                  #lightgallery.thumbnails.scrollmenu
                    if biz.gallery
                      each image in biz.gallery
                        a.nopadding(href='/uploads/'+image.filename, width="", alt='#{biz.slug}')
                          .thumbnail.bizdetail-photo
                            img.img-thumbnail.img-responsive(src='/uploads/thumbs/gallery-'+image.filename,  alt='')
                      .pull-left
                        small
                          strong
                            | Scroll this Gallery Left or Right
                .row
                  if(biz.deliverylink)
                    .col-md-6.col-md-offset-3(style="background-color:#00aabb;padding:5px;border-radius:25px;")
                      p 
                        span.fas.fa-motorcycle(style="color:#fdfdfd;")
                        a.findit(href="http://"+biz.deliverylink,target="_blank",style="color:#fdfdfd;font-size:18px")
                          strong
                            |  Place Your Order Now
                
                  if(biz.bookinglink)
                    .col-md-6.col-md-offset-3(style="background-color:#00aabb;padding:5px;border-radius:25px;")
                      p 
                        span.fas.fa-plane(style="color:#fdfdfd;")
                        a.findit(href="http://"+biz.bookinglink,target="_blank",style="color:#fdfdfd;font-size:18px;")
                          strong
                            |  Book or Reserve Now
                if biz.description
                  #web-view
                    .panel
                      .findit-red.padding10top
                        strong More Information
                      .panel-body
                        p.padding-p  !{biz.description}
                  .hideonclick
                    #mobile-view
                      .panel
                        .findit-red.padding10top
                          strong More Information
                        .panel-body
                          p.padding-p 
                            if biz.description.length > 250
                              p.padding.text-left.description-cat  !{biz.description.substr(0, 250)+ '..... <strong id="showmore" style="background-color:#c00000; color:#fff; padding:1px">Read More</strong>'}
                  #show-more
                    .panel
                      .findit-red.padding10top
                        strong More Information
                      .panel-body
                        p.padding-p  !{biz.description} 
                          | ..... 
                          strong(id="showless" style="background-color:#c00000; color:#fff; padding:1px") Read Less   
                    
                .row
                  .panel-body              
                    if biz.extras.length 
                      strong.findit-red
                        h4 Ammenities  
                      each extra in biz.extras 
                          span.label.label-dark
                            span.extra-space
                              =extra + ','
                    else
                        | 
        
    
              .col-md-3
                if(coupons.length > 0)
                  div
                    h4
                      strong
                        | Coupons in This Business  
                  div       
                    each coupon in coupons 
                      a(href="/coupons")
                        row
                          .col-md-12.is-island
                              h6
                                =coupon.name
                              img.coup-img.img-fluid(src="/uploads/thumbs/coupons/"+ coupon.photo, alt="Responsive image")
                              .div
                                  h6
                                    =coupon.bizid.name
                                  p
                                    =coupon.description
                              .div
                                  =coupon.tagline       
                else 
                  div   
                if(branches)
                  div.col-md-12
                    h4
                      strong.text-center
                        | Branches
                  div.col-md-12       
                    each branch in branches          
                      a(href="/biz/"+branch.slug) 
                        div.col-md-12.is-island
                          h6.findit-red
                            =branch.name
                  
                if(similarbiz)
                  div.col-md-12
                    h4
                      strong.text-center
                        | Similar Businesses
                  div.col-md-12       
                    each bizna in similarbiz            
                      a(href="/biz/"+bizna.slug) 
                        div.col-md-12.is-island
                          h6.findit-red
                            =bizna.name
                          p
                            =bizna.subcategory
      .row      
          .col-md-12
            h3.text-left
              | Reviews
            each review in biz.reviews              
              .row               
                .col-md-1.text-left 
                  span.fas.fa-comment-alt
                .col-md-3
                  .col-md-12(class="rating medium star-icon value-"+review.rate+" label-hidden")
                    .star-container
                      .star
                        i.star-empty
                        i.star-half
                        i.star-filled
                      .star
                        i.star-empty
                        i.star-half
                        i.star-filled
                      .star
                        i.star-empty
                        i.star-half
                        i.star-filled
                      .star
                        i.star-empty
                        i.star-half
                        i.star-filled
                      .star
                        i.star-empty
                        i.star-half
                        i.star-filled
                .col-md-8.text-left
                  p
                    | !{review.msg}
              hr
      .row    
        if biz.youtube
          h3.text-left
            | Youtube
          .col-md-6
            iframe(width='100%', height='315', src="https://"+biz.youtube, allow=" encrypted-media" allowfullscreen)
        
      .row(style="margin-bottom:2rem")
        .col-md-12 
          .row
            hr
            .col-md-12.text-center
              .findit-red.padding10
                strong.findit-red 
                  span.fas.fa-comment
                  |   Submit a Review
            .col-md-12
              form.form-horizontal(method="post",action="/business/review/")                
                .col-md-12
                  textarea.form-control-form(name='review',required)
                  input#bizid(type='hidden', name='bizid',value=biz.id)
                .col-md-12.text-left
                  strong
                    | Star Rating
                    fieldset.ratings
                      input#star5(type='radio', name='rating', value='5')
                      label.full(for='star5', title='Awesome - 5 stars')
                      input#star4half(type='radio', name='rating', value='4 half')
                      label.half(for='star4half', title='Pretty good - 4.5 stars')
                      input#star4(type='radio', name='rating', value='4')
                      label.full(for='star4', title='Pretty good - 4 stars')
                      input#star3half(type='radio', name='rating', value='3 half')
                      label.half(for='star3half', title='Meh - 3.5 stars')
                      input#star3(type='radio', name='rating', value='3')
                      label.full(for='star3', title='Meh - 3 stars')
                      input#star2half(type='radio', name='rating', value='2 half')
                      label.half(for='star2half', title='Kinda bad - 2.5 stars')
                      input#star2(type='radio', name='rating', value='2')
                      label.full(for='star2', title='Kinda bad - 2 stars')
                      input#star1half(type='radio', name='rating', value='1 half')
                      label.half(for='star1half', title='Meh - 1.5 stars')
                      input#star1(type='radio', name='rating', value='1')
                      label.full(for='star1', title='Sucks big time - 1 star')
                      input#starhalf(type='radio', name='rating', value='half')
                      label.half(for='starhalf', title='Sucks big time - 0.5 stars')
                .col-md-12
                  button.button.btn.btn-danger.form-control(type='submit') Submit Review                
          
      script.
        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.
        var map, infoWindow;
        function initMap() {
          infoWindow = new google.maps.InfoWindow;
          // Try HTML5 geolocation.
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            map = new google.maps.Map(document.getElementById('map'), {
              center: pos,
              zoom: 15
            });

            var marker = new google.maps.Marker({
              position: pos,
              title: 'My Location',
              icon: 'https://findit.ke/img/if_the_iron_man.png',
              map: map
            });
            var branches = !{JSON.stringify(branches)};
            console.log(branches);
            branches.forEach(function(biz) {
              if(typeof biz.map === 'undefined' || biz.map === null){
                
              }else{
                var bizpos = {
                  lat: parseFloat(biz.map.lati),
                  lng: parseFloat(biz.map.long)
                };
                var marker = new google.maps.Marker({
                  position: bizpos,
                  title: biz.name,
                  animation: google.maps.Animation.DROP,
                  map: map
                });
                marker.info = new google.maps.InfoWindow({
                  content: '<b>'+ biz.name +'</b> <p>'+biz.subcategory+'</p>'
                });

                google.maps.event.addListener(marker, 'click', function() {
                  marker.info.open(map, marker);
                });
              }
              
            });

            function toggleBounce() {
              if (marker.getAnimation() !== null) {
                marker.setAnimation(null);
              } else {
                marker.setAnimation(google.maps.Animation.BOUNCE);
              }
            }
            
            // Create markers.
            
            infoWindow.open(map);
            map.setCenter(pos);
            }, function() {
              handleLocationError(true, infoWindow, map.getCenter());
            });
            } else {
              // Browser doesn't support Geolocation
              handleLocationError(false, infoWindow, map.getCenter());
            }
        }
        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(browserHasGeolocation ? 'Error: The Geolocation service failed.' : 'Error: Your browser doesnt support geolocation.');
          infoWindow.open(map);
        }
      script(async='', defer='', src='https://maps.googleapis.com/maps/api/js?key=AIzaSyC9MX39yDkMJn6rjWi6vt4Rens5u_cVBQE&callback=initMap&zoom=17')
